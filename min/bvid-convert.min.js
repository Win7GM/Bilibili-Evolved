(()=>(i,e)=>{const n=["https://www.bilibili.com/video/","https://www.bilibili.com/bangumi/"].some((i=>document.URL.startsWith(i)));if(i.preferAvUrl&&document.URL.startsWith("https://www.bilibili.com/video/")){SpinQuery.select((()=>unsafeWindow.aid)).then((i=>{if(!i){return}if(document.URL.includes("videocard_series")){console.log("skip video series");return}const e=document.URL.replace(/\/(video|bangumi)\/(BV[\w]+)/i,((e,n)=>`/${n}/av${i}`));if(document.URL!==e){history.replaceState({},document.title,e)}}))}return{widget:{content:`<div class="bvid-convert"></div>`,condition:async()=>{if(n){return Boolean(await SpinQuery.select((()=>unsafeWindow.aid||unsafeWindow.bvid)))}else{return false}},success:()=>{e.applyStyle("bvidConvertStyle");const i=async()=>{const i=dq(".bvid-convert");i.innerHTML=`\n<div class="bvid-convert-item">av${unsafeWindow.aid}</div>\n<div class="bvid-convert-item">${unsafeWindow.bvid}</div>\n`;const e=await SpinQuery.select(".av-link,.bv-link,.bvid-link");if(e){i.innerHTML=`\n<div class="bvid-convert-item">av${unsafeWindow.aid}</div>\n<div class="bvid-convert-item">${e.innerHTML}</div>\n`}};Observer.videoChange(i)}}}})();