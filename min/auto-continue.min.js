(()=>(e,i)=>{if(typeof isEmbeddedPlayer!=="undefined"&&isEmbeddedPlayer()){return}function t(i){const t=i.text();if(/第(\d+)话/.test(t)){if(e.allowJumpContinue){i.parent().find(".bilibili-player-video-toast-item-jump").click()}return}const n=/((\d)*:)?(\d)*:(\d)*/g;const o=t.match(n);if(!o){return}const r=o[0].split(":");const l=(()=>{if(r.length===3){const[e,i,t]=r.map((e=>parseInt(e)));return e*60*60+i*60+t}else if(r.length===2){const[e,i]=r.map((e=>parseInt(e)));return e*60+i}else{logError(`解析历史时间发生错误: historyTime=${JSON.stringify(r)}`);return NaN}})();const s=i.parent();const a=document.querySelector("video");if(l<a.duration){a.currentTime=l;a.play();s.find(".bilibili-player-video-toast-item-jump").remove();const e=$(`<div class="bilibili-player-video-toast-item-jump">从头开始</div>`);e.appendTo(s).on("click",(()=>{a.currentTime=0;s.find(".bilibili-player-video-toast-item-close").get(0).click()}));i.html(`<span>已跳转到上次历史记录</span><span>${o[0]}</span>`)}else{s.find(".bilibili-player-video-toast-item-close").get(0).click()}}function n(){SpinQuery.condition((()=>$(".bilibili-player-video-toast-item-text")),(e=>e.text().indexOf("上次看到")!==-1),(e=>t(e.filter(((e,i)=>i.innerText.indexOf("上次看到")!==-1)))))}Observer.videoChange(n)})();